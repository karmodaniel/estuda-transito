<div class="placas-page">
  <!-- Configurações de Visualização -->
  <nz-card nzTitle="Configurações de Visualização" class="config-card">
    <div class="config-content">
      <p class="config-description">
        Selecione quais informações deseja visualizar para ajudar na memorização:
      </p>
      
      <div class="opcoes-grid">
        <nz-checkbox 
          [(ngModel)]="opcoesVisualizacao.mostrarImagem"
          (ngModelChange)="alternarOpcaoVisualizacao('mostrarImagem')"
        >
          Mostrar Imagem
        </nz-checkbox>
        
        <nz-checkbox 
          [(ngModel)]="opcoesVisualizacao.mostrarCodigo"
          (ngModelChange)="alternarOpcaoVisualizacao('mostrarCodigo')"
        >
          Mostrar Código
        </nz-checkbox>
        
        <nz-checkbox 
          [(ngModel)]="opcoesVisualizacao.mostrarNome"
          (ngModelChange)="alternarOpcaoVisualizacao('mostrarNome')"
        >
          Mostrar Nome
        </nz-checkbox>
        
        <nz-checkbox 
          [(ngModel)]="opcoesVisualizacao.mostrarDescricao"
          (ngModelChange)="alternarOpcaoVisualizacao('mostrarDescricao')"
        >
          Mostrar Descrição
        </nz-checkbox>
        
        <nz-checkbox 
          [(ngModel)]="opcoesVisualizacao.mostrarCategoria"
          (ngModelChange)="alternarOpcaoVisualizacao('mostrarCategoria')"
        >
          Mostrar Categoria
        </nz-checkbox>
      </div>
    </div>
  </nz-card>

  <!-- Filtros -->
  <nz-card nzTitle="Filtros" class="filtros-card">
    <div class="filtros-content">
      <!-- Pesquisa -->
      <div class="pesquisa-section">
        <nz-input-group [nzSuffix]="suffixIconSearch">
          <input 
            nz-input 
            placeholder="Pesquisar placas..." 
            [(ngModel)]="termoPesquisa"
            (input)="pesquisar(termoPesquisa)"
          />
        </nz-input-group>
        <ng-template #suffixIconSearch>
          <span nz-icon nzType="search"></span>
        </ng-template>
      </div>

      <!-- Categorias -->
      <div class="categorias-section">
        <h4>Categorias:</h4>
        <div class="categoria-buttons">
          <button 
            nz-button 
            [nzType]="categoriaSelecionada === '' ? 'primary' : 'default'"
            (click)="filtrarPorCategoria('')"
            class="categoria-btn"
          >
            Todas
          </button>
          <button 
            *ngFor="let categoria of categorias"
            nz-button 
            [nzType]="categoriaSelecionada === categoria ? 'primary' : 'default'"
            (click)="filtrarPorCategoria(categoria)"
            class="categoria-btn"
          >
            {{ getNomeCategoria(categoria) }}
          </button>
        </div>
      </div>

      <!-- Limpar filtros -->
      <div class="limpar-filtros">
        <button 
          nz-button 
          nzType="default" 
          (click)="limparFiltros()"
          [disabled]="!categoriaSelecionada && !termoPesquisa"
        >
          <span nz-icon nzType="clear"></span>
          Limpar Filtros
        </button>
      </div>
    </div>
  </nz-card>

  <!-- Lista de placas -->
  <nz-card [nzTitle]="'Placas encontradas: ' + placasFiltradas.length">
    <!-- Loading -->
    <div *ngIf="loading" class="loading-container">
      <nz-spin nzSize="large">
        <span class="loading-text">Carregando placas...</span>
      </nz-spin>
    </div>

    <!-- Mensagem quando não há opções selecionadas -->
    <div *ngIf="!loading && !temOpcaoAtiva()" class="no-options">
      <nz-empty 
        nzNotFoundImage="simple"
        [nzNotFoundContent]="'Selecione pelo menos uma opção de visualização para ver as placas.'"
      >
      </nz-empty>
    </div>

    <!-- Grid de placas -->
    <div *ngIf="!loading && temOpcaoAtiva()" class="placas-grid">
      <nz-card 
        *ngFor="let placa of placasFiltradas" 
        class="placa-card"
        [nzTitle]="opcoesVisualizacao.mostrarCodigo ? (placa.codigo + ' - ' + placa.nome) : placa.nome"
      >
        <div class="placa-content">
          <!-- Imagem da placa -->
          <div *ngIf="opcoesVisualizacao.mostrarImagem" class="placa-imagem">
            <img 
              [src]="placa.imagem_url" 
              [alt]="placa.nome"
              (error)="onImageError($event)"
              class="placa-img"
            />
          </div>

          <!-- Informações da placa -->
          <div class="placa-info">
            <p *ngIf="opcoesVisualizacao.mostrarDescricao" class="placa-descricao">
              {{ placa.descricao }}
            </p>
            
            <div *ngIf="opcoesVisualizacao.mostrarCategoria" class="placa-categoria">
              <nz-tag [nzColor]="getCategoriaColor(placa.categoria)">
                {{ getNomeCategoria(placa.categoria) }}
              </nz-tag>
            </div>
          </div>
        </div>
      </nz-card>
    </div>

    <!-- Mensagem quando não há resultados -->
    <div *ngIf="!loading && temOpcaoAtiva() && placasFiltradas.length === 0" class="no-results">
      <nz-empty 
        nzNotFoundImage="simple"
        [nzNotFoundContent]="'Nenhuma placa encontrada com os filtros aplicados.'"
      >
      </nz-empty>
    </div>
  </nz-card>
</div>
